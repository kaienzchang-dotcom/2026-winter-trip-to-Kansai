<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>2026 å†¬æ—¥é—œè¥¿è¦ªå­è‡ªé§•ï¼šå±±æµ·æ¹–ãƒ»å¤éƒ½ç‰ç’ƒå…‰ï¼ˆ8å¤©7å¤œï¼‰</title>
  <meta name="description" content="2026/2/7â€“2/14 å†¬æ—¥é—œè¥¿è¦ªå­è‡ªé§•è¡Œç¨‹ï¼šä¸‰é‡ã€æ»‹è³€ã€å®‡æ²»ã€å¥ˆè‰¯ã€å¤§é˜ªã€‚æ‰‹æ©Ÿå‹å–„ï¼šæ—¥æœŸåˆ‡æ›ã€é—œéµå­—æœå°‹ã€æ–‡å­—ç¸®æ”¾ã€æ¯æ—¥äº’å‹•åœ°åœ–ï¼‹ä¸€éµé–‹ç•¶æ—¥å¤šé»è·¯ç·šã€‚" />
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(0,0,0,.24);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.65);
      --line: rgba(255,255,255,0.12);
      --accent: #79d7ff;
      --warn:#ffd479;
      --good:#80f7c4;
      --bad:#ff7aa2;
      --radius: 16px;
      --shadow: 0 10px 35px rgba(0,0,0,.35);
      --scale: 1;
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "PingFang TC", "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;

      --safeTop: env(safe-area-inset-top, 0px);
      --safeBot: env(safe-area-inset-bottom, 0px);
    }
    *{ box-sizing: border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(121,215,255,.15), transparent 60%),
        radial-gradient(900px 600px at 80% 20%, rgba(167,139,250,.12), transparent 60%),
        radial-gradient(800px 600px at 50% 90%, rgba(128,247,196,.08), transparent 60%),
        var(--bg);
      color: var(--text);
      font-family: var(--font);
      line-height: 1.6;
      font-size: calc(16px * var(--scale));
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }
    a{ color: var(--accent); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    /* ===== Mobile-first layout ===== */
    .app{
      max-width: 980px;
      margin: 0 auto;
      padding: calc(12px + var(--safeTop)) 12px calc(90px + var(--safeBot));
    }

    .card{
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .stack{ display:flex; flex-direction:column; gap: 12px; }

    .title{
      font-size: 1.15em;
      font-weight: 900;
      letter-spacing: .2px;
      margin: 0;
    }
    .subtitle{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: .95em;
    }
    .pillrow{ display:flex; flex-wrap:wrap; gap: 8px; margin-top: 10px; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--line);
      color: var(--muted);
      font-size: .9em;
      user-select: none;
    }
    .pill b{ color: var(--text); font-weight: 800; }

    .hero{
      background: linear-gradient(135deg, rgba(121,215,255,.14), rgba(167,139,250,.10));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .hero h1{ margin: 0; font-size: 1.35em; letter-spacing: .2px; }
    .hero p{ margin: 10px 0 0; color: var(--muted); }

    .route{
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      background: var(--panel2);
      border: 1px solid var(--line);
      color: var(--muted);
    }
    .route b{ color: var(--text); }

    details.day{
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    details.day[open]{ background: rgba(255,255,255,.07); }
    summary{
      list-style:none;
      cursor:pointer;
      padding: 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }

    .sumL{ display:flex; flex-direction:column; gap: 4px; min-width: 0; }
    .sumTitle{ font-weight: 900; font-size: 1.05em; }
    .sumSub{
      color: var(--muted);
      font-size: .92em;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .sumR{
      color: var(--muted);
      font-size: .88em;
      white-space:nowrap;
      opacity:.9;
      padding-top: 2px;
    }

    .body{
      border-top: 1px solid var(--line);
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .section{
      background: rgba(0,0,0,.18);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
    }
    .section h3{ margin: 0 0 8px; font-size: 1.02em; }

    .items{ display:flex; flex-direction:column; gap: 10px; }
    .item{
      padding: 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .item .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .item .name{ font-weight: 850; min-width:0; }
    .item .time{ color: var(--muted); font-size: .9em; white-space:nowrap; }
    .item .desc{ margin-top: 6px; color: var(--muted); }

    .tagrow{ margin-top: 8px; display:flex; flex-wrap:wrap; gap: 6px; }
    .tag{
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.05);
      font-size: .85em;
      color: var(--muted);
    }
    .tag.warn{ color: #1a1200; background: rgba(255,212,121,.85); border-color: rgba(255,212,121,.55); }
    .tag.good{ color: #002015; background: rgba(128,247,196,.78); border-color: rgba(128,247,196,.45); }
    .tag.bad{ color: #26000e; background: rgba(255,122,162,.75); border-color: rgba(255,122,162,.45); }

    .maps{ display:flex; flex-wrap:wrap; gap: 8px; margin-top: 10px; }
    .maplink{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.22);
      color: var(--text);
      text-decoration:none;
      font-size: .95em;
      width: 100%;
    }
    .maplink:hover{ background: rgba(255,255,255,.10); text-decoration:none; }
    .maplink .pin{ filter: drop-shadow(0 3px 8px rgba(0,0,0,.3)); }
    @media (min-width: 520px){
      .maplink{ width: auto; }
    }

    /* Map area */
    .mapBoxHead{
      display:flex;
      flex-direction:column;
      gap: 10px;
      margin-bottom: 10px;
    }
    .mapControls{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
    }
    .select{
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.25);
      border: 1px solid var(--line);
      color: var(--text);
      outline: none;
      font: inherit;
      -webkit-appearance: none;
      appearance: none;
    }
    .mapFrameWrap{
      border: 1px solid var(--line);
      border-radius: 14px;
      overflow:hidden;
      background: rgba(0,0,0,.22);
    }
    .mapFrame{
      width: 100%;
      height: 320px;
      border: 0;
      display:block;
    }
    @media (min-width: 760px){
      .mapFrame{ height: 360px; }
      .mapBoxHead{ flex-direction:row; align-items:flex-start; justify-content:space-between; }
      .mapControls{ justify-content:flex-end; }
      .select{ width: 360px; }
    }

    .recap{
      background: linear-gradient(135deg, rgba(255,212,121,.14), rgba(255,122,162,.10));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .recap h2{ margin:0; font-size: 1.15em; }
    .recap ul{ margin: 10px 0 0; padding-left: 20px; color: var(--muted); }
    .small{ color: var(--muted); font-size: .92em; }
    .hidden{ display:none !important; }

    mark{
      background: rgba(121,215,255,.22);
      color: var(--text);
      padding: 0 .15em;
      border-radius: .35em;
    }

    /* ===== Mobile sticky bottom bar (controls) ===== */
    .bottomBar{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px 12px calc(10px + var(--safeBot));
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--line);
      z-index: 50;
    }
    .bottomBarInner{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .row{
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .row > *{ flex: 1; }
    .search{
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.30);
      border: 1px solid var(--line);
      color: var(--text);
      outline: none;
    }
    .search::placeholder{ color: rgba(255,255,255,.45); }
    .btn{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 12px 12px;
      border-radius: 14px;
      cursor: pointer;
      font: inherit;
      width: 100%;
      white-space: nowrap;
    }
    .btn:active{ transform: translateY(1px); }

    .zoomRow{
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .zoomRow span{ color: var(--muted); font-size: .92em; white-space:nowrap; }
    .zoomRow input[type="range"]{ width: 100%; }
    .toolbarHint{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      color: var(--muted);
      font-size: .88em;
    }

    /* Floating "Jump to Day" button for very fast navigation */
    .fab{
      position: fixed;
      right: 12px;
      bottom: calc(96px + var(--safeBot));
      z-index: 60;
      border-radius: 999px;
      padding: 12px 14px;
      background: rgba(121,215,255,.20);
      border: 1px solid rgba(121,215,255,.35);
      color: var(--text);
      box-shadow: var(--shadow);
      cursor:pointer;
      user-select:none;
    }
    .fab:active{ transform: translateY(1px); }

    /* Bottom sheet for day navigation */
    .sheetBack{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      z-index: 80;
      display:none;
    }
    .sheet{
      position: fixed;
      left: 0; right:0;
      bottom: 0;
      z-index: 90;
      background: rgba(10,14,28,.92);
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      padding: 12px 12px calc(12px + var(--safeBot));
      transform: translateY(110%);
      transition: transform .22s ease;
      max-height: 70vh;
      overflow:auto;
    }
    .sheet.open{ transform: translateY(0); }
    .sheetBack.show{ display:block; }
    .sheetHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .sheetTitle{ font-weight: 900; }
    .closeX{
      width: 42px; height: 42px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor:pointer;
      font-size: 18px;
      line-height: 42px;
      text-align:center;
    }
    .daylist{
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .daylink{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border: 1px solid var(--line);
      cursor:pointer;
      user-select:none;
    }
    .daylink .left{ display:flex; flex-direction:column; gap: 2px; min-width: 0; }
    .daylink .d{ font-weight: 900; }
    .daylink .meta{
      color: var(--muted);
      font-size: .88em;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      max-width: 70vw;
    }
    .badge{
      padding: 4px 8px;
      border-radius: 999px;
      font-size: .82em;
      border: 1px solid var(--line);
      color: var(--muted);
      white-space:nowrap;
      opacity:.9;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="stack">
      <section class="hero">
        <p class="title" style="margin:0;">å±±æµ·æ¹–ãƒ»å¤éƒ½ç‰ç’ƒå…‰</p>
        <p class="subtitle">2026 å†¬æ—¥é—œè¥¿è¦ªå­è‡ªé§•ï½œ8 å¤© 7 å¤œï¼ˆ2/7â€“2/14ï¼‰</p>
        <div class="pillrow">
          <span class="pill">ğŸ§­ <b>ä¸€éµé–‹ç•¶æ—¥è·¯ç·š</b></span>
          <span class="pill">ğŸ—ºï¸ <b>æ¯æ—¥äº’å‹•åœ°åœ–</b></span>
          <span class="pill">â„ï¸ <b>é›ªåœ°è¼ªèƒ</b> å¿…é¸</span>
        </div>
        <p style="margin:10px 0 0; color:var(--muted);">
          ä¸‰é‡ç‡ˆå…‰ç§€ï¼‹å¾¡åœ¨æ‰€æ¨¹å†°ç©é›ªï¼‹é³¥ç¾½æµ·æ´‹æ¢éšªï¼‹æ»‹è³€ç®±é¤¨å±±ç©é›ªï¼†æ°´æ‰å¤§é“ï¼‹å®‡æ²»æŠ¹èŒ¶ï¼‹å¥ˆè‰¯ç‰ç’ƒç¹ªï¼‹å¤§é˜ªè¦ªå­é»ã€‚
        </p>
        <div class="route">
          <b>è·¯ç·šæ¦‚å¿µï¼š</b> é—œè¥¿æ©Ÿå ´ â†’ ä¸‰é‡æ¡‘å â†’ è°é‡ â†’ é³¥ç¾½ â†’ æ»‹è³€ â†’ å®‡æ²» â†’ å¥ˆè‰¯ â†’ å¤§é˜ª â†’ é—œè¥¿æ©Ÿå ´
          <div class="small" style="margin-top:6px;">é€†æ™‚é‡ç’°ç‹€ç¹è¡Œï¼Œä¸èµ°å›é ­è·¯ã€‚</div>
        </div>
      </section>

      <section id="days" class="stack"></section>

      <section class="recap">
        <h2>ğŸ’¡ æœ€çµ‚é‡è¦æé†’ï¼ˆRecapï¼‰</h2>
        <ul>
          <li><b>ç§Ÿè»Šå‹™å¿…æŒ‡å®šé›ªåœ°è¼ªèƒï¼ˆSnow Tiresï¼‰</b>ï¼šå¾¡åœ¨æ‰€ã€çµç¶æ¹–ã€å¥ˆè‰¯å¤œé–“è·¯é¢å¯èƒ½çµå†°æˆ–ç©é›ªã€‚</li>
          <li><b>Day 5 å¥ˆè‰¯ç‰ç’ƒç¹ªä¿æš–</b>ï¼šå…¨æˆ¶å¤–ï¼Œè«‹å‚™å¸½å­ã€æ‰‹å¥—ã€æš–æš–åŒ…ã€‚</li>
          <li><b>å°èˆªå»ºè­°</b>ï¼šå„ªå…ˆç”¨æ™¯é»åç¨±ï¼é›»è©±ï¼ˆæˆ– MapCodeï¼‰æ¯”åœ°å€æ›´æº–ã€‚</li>
        </ul>
        <div class="small" style="margin-top:8px;">æ‰‹æ©Ÿç‰ˆï¼šåº•éƒ¨å·¥å…·åˆ—å¯æœå°‹/ç¸®æ”¾/å±•é–‹æ”¶åˆ/è¤‡è£½åˆ†äº«æ–‡å­—ï¼›å³ä¸‹å¯å¿«é€Ÿè·³ Dayã€‚</div>
      </section>
    </div>
  </div>

  <!-- Floating Jump -->
  <button id="fab" class="fab" type="button">ğŸ“… è·³ Day</button>

  <!-- Bottom Sheet -->
  <div id="sheetBack" class="sheetBack"></div>
  <div id="sheet" class="sheet" role="dialog" aria-modal="true" aria-label="ä¾æ—¥æœŸæª¢ç´¢">
    <div class="sheetHeader">
      <div class="sheetTitle">ğŸ“… ä¾æ—¥æœŸæª¢ç´¢</div>
      <div id="closeSheet" class="closeX" role="button" aria-label="é—œé–‰">âœ•</div>
    </div>
    <div id="daylist" class="daylist"></div>
  </div>

  <!-- Sticky Bottom Bar -->
  <div class="bottomBar">
    <div class="bottomBarInner">
      <div class="row">
        <input id="q" class="search" type="search" placeholder="æœå°‹ï¼šç®±é¤¨å±± / æŠ¹èŒ¶ / AEON / ç‰ç’ƒç¹ª / æº«æ³‰ / æ°´æ‰â€¦" autocomplete="off" />
        <button id="share" class="btn" type="button">åˆ†äº«</button>
      </div>
      <div class="zoomRow">
        <span id="zoomLabel">100%</span>
        <input id="zoom" type="range" min="85" max="135" step="5" value="100" />
        <button id="openAll" class="btn" type="button">å±•é–‹</button>
        <button id="closeAll" class="btn" type="button">æ”¶åˆ</button>
      </div>
      <div class="toolbarHint">
        <span>æç¤ºï¼šæ¯ä¸€å¤©éƒ½æœ‰ã€Œé–‹ç•¶æ—¥è·¯ç·šï¼ˆå¤šé»ï¼‰ã€</span>
        <span>é›¢ç·šåˆ†äº«ï¼šå‚³ HTML æª”å³å¯</span>
      </div>
    </div>
  </div>

<script>
  // ===== Map URL helpers =====
  const mapsSearch = (q) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`;
  const mapsEmbed  = (q) => `https://www.google.com/maps?q=${encodeURIComponent(q)}&output=embed`;
  const mapsLink   = (url) => url;

  // Google Maps multi-stop directions (driving)
  const mapsDirections = (points, travelmode="driving") => {
    const clean = (points || []).map(s => (s || "").trim()).filter(Boolean);
    if (clean.length === 0) return "https://www.google.com/maps";
    if (clean.length === 1) return mapsSearch(clean[0]);

    const origin = clean[0];
    const destination = clean[clean.length - 1];
    const waypoints = clean.slice(1, -1);

    const params = new URLSearchParams();
    params.set("api", "1");
    params.set("origin", origin);
    params.set("destination", destination);
    params.set("travelmode", travelmode);
    if (waypoints.length) params.set("waypoints", waypoints.join("|"));

    return `https://www.google.com/maps/dir/?${params.toString()}`;
  };

  // ===== DOM helper =====
  const el = (tag, attrs={}, children=[]) => {
    const n = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)){
      if (k === "class") n.className = v;
      else if (k === "html") n.innerHTML = v;
      else if (k.startsWith("on") && typeof v === "function") n.addEventListener(k.substring(2), v);
      else n.setAttribute(k, v);
    }
    (Array.isArray(children) ? children : [children]).forEach(c=>{
      if (c == null) return;
      if (typeof c === "string") n.appendChild(document.createTextNode(c));
      else n.appendChild(c);
    });
    return n;
  };

  const highlight = (text, query) => {
    if (!query) return text;
    const q = query.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    const re = new RegExp(`(${q})`, "gi");
    return text.replace(re, "<mark>$1</mark>");
  };

  // ===== Data (itinerary) =====
  // Day2 å·²ç§»é™¤ KASAHAN
  // Day5 å·²ç¢ºä¿ä¸åŒ…å«ä»»ä½•ã€ŒNARA Thai Cuisine æ¡ƒåœ’è¯æ³°åº—ã€ç›¸é—œå­—ä¸²
  const trip = {
    title: "2026 å†¬æ—¥é—œè¥¿è¦ªå­è‡ªé§•ï¼šå±±æµ·æ¹–ãƒ»å¤éƒ½ç‰ç’ƒå…‰",
    range: "2026/2/7â€“2/14",
    days: [
      {
        id: "day1",
        date: "2026/2/7ï¼ˆå…­ï¼‰",
        dayLabel: "Day 1",
        headline: "æŠµé”èˆ‡å…‰ä¹‹çµ•æ™¯ï½œæ¡‘åç‡ˆå…‰ç§€",
        areas: ["é—œè¥¿æ©Ÿå ´", "ä¸‰é‡ãƒ»æ¡‘å"],
        sections: [
          { title: "è¡Œç¨‹", items: [
            { time: "13:00", name: "é—œè¥¿æ©Ÿå ´ æŠµé”ï¼ç§Ÿè»Š", desc: "å‹™å¿…æŒ‡å®šï¼šé›ªåœ°è¼ªèƒï¼ˆSnow Tiresï¼‰ã€‚", places:["Kansai International Airport"]},
            { time: "ä¸‹åˆ", name: "é§•è»Šå‰å¾€ ä¸‰é‡ç¸£æ¡‘åå¸‚", desc: "è»Šç¨‹ç´„ 1.5â€“2 å°æ™‚ã€‚", places:["Kuwana, Mie"]},
            { time: "ä¸‹åˆ", name: "AEON MALL KUWANA", desc: "å®¤å…§éŠæ¨‚æ”¾é›»ï¼›Uniqlo æ¡è²·ï¼›æ™šé¤å•†å ´è§£æ±ºã€‚", places:["AEON MALL Kuwana"]},
            { time: "18:30â€“", name: "åèŠ±ä¹‹é‡Œï¼ˆNabana no Satoï¼‰ç‡ˆå…‰ç§€", desc: "å…‰ä¹‹éš§é“ã€æ°´ä¸Šç‡ˆæµ·ã€ä¸»ç‡ˆå€ã€‚", places:["Nabana no Sato"]},
            { time: "ä½å®¿", name: "Super Hotel Kuwana Ekimae", desc: "æ¡‘åç«™å‰ã€‚", places:["Super Hotel Kuwana Ekimae"]},
          ] }
        ]
      },
      {
        id: "day2",
        date: "2026/2/8ï¼ˆæ—¥ï¼‰",
        dayLabel: "Day 2",
        headline: "å¾¡åœ¨æ‰€æ¨¹å†°çºœè»Šï¼‹è¨­è¨ˆç¾å­¸æº«æ³‰ï¼ˆç‰¹è‰²æº«æ³‰ Iï¼‰",
        areas: ["ä¸‰é‡ãƒ»è°é‡", "é³¥ç¾½"],
        sections: [
          { title: "è¡Œç¨‹", items: [
            { time: "ä¸Šåˆ", name: "å¾¡åœ¨æ‰€çºœè»Šï¼ˆGozaisho Ropewayï¼‰", desc: "æ¨¹å†°ã€å†°ç€‘ï¼›å±±é ‚ç©é›ªå€ã€‚", places:["Gozaisho Ropeway"]},
            { time: "åˆé¤", name: "Aquaignisï¼ˆç‰‡å²¡æº«æ³‰ï¼‰", desc: "Confiture Hï¼ˆè¾»å£åšå•Ÿï¼‰ç­‰ã€‚", places:["AQUAIGNIS", "Kataoka Onsen", "Confiture H"]},
            { time: "ä¸‹åˆ", name: "é§•è»Šå—ä¸‹ é³¥ç¾½", desc: "è»Šç¨‹ç´„ 1 å°æ™‚ã€‚", places:["Toba, Mie"]},
            { time: "æ™šé¤/ä½å®¿", name: "æˆ¶ç”°å®¶ï¼ˆTodayaï¼‰", desc: "æµ·æ™¯ï¼‹æµ·é®®æœƒå¸­ã€‚", places:["Toba Hotel Todaya"]},
          ] }
        ]
      },
      {
        id: "day3",
        date: "2026/2/9ï¼ˆä¸€ï¼‰",
        dayLabel: "Day 3",
        headline: "æµ·æ´‹æ¢éšªï¼‹æ±Ÿæˆ¶å¤é“ï¼‹å¤æ°‘å®¶é«”é©—",
        areas: ["é³¥ç¾½", "ä¼Šå‹¢", "é—œå®¿", "æ»‹è³€ãƒ»é«˜å³¶"],
        sections: [
          { title: "è¡Œç¨‹", items: [
            { time: "ä¸Šåˆ", name: "é³¥ç¾½æ°´æ—é¤¨", desc: "æµ·çºèˆ‡å„’è‰®å¿…çœ‹ã€‚", places:["Toba Aquarium"]},
            { time: "åˆé¤", name: "æ‰˜ç¦æ©«ä¸ï¼ˆOkage Yokochoï¼‰", desc: "ä¼Šå‹¢ç¥å®®å‰è€è¡—ã€‚", places:["Okage Yokocho"]},
            { time: "ä¸‹åˆ", name: "é—œå®¿ï¼ˆSeki-jukuï¼‰", desc: "æ±Ÿæˆ¶é©›ç«™æ•£æ­¥ã€‚", places:["Seki-juku"]},
            { time: "å‚æ™š", name: "Biwako Baseï¼ˆçµç¶æ¹–ç•”ï¼‰", desc: "é»ƒæ˜æ¹–æ™¯ä¼‘æ¯ã€‚", places:["Biwako Base"]},
            {
              time: "æ™šä¸Š/ä½å®¿",
              name: "å¤æ°‘å®¶ Onigiriï¼ˆKominka Onigiriï¼‰",
              desc: "æ•´æ£Ÿå‡ºç§Ÿï¼›å¯æ¡è²·å›æ°‘å®¿ç‚Šç…®ï¼›è·ç®±é¤¨å±±è¿‘ã€‚",
              placeLinks: [
                { label: "Google Mapsï¼šå¤æ°‘å®¶ Onigiriï¼ˆKominka Onigiriï¼‰", url: "https://maps.app.goo.gl/wDN1ED6KjqT8F6S67" }
              ]
            },
          ]},
          { title: "å…¥ä½å°æé†’", items: [
            { time: "æé†’", name: "é¤é£²è¦åŠƒ", desc: "å‘¨é‚Šå…¥å¤œé¤å»³å°‘ï¼Œå»ºè­°å…ˆæ¡è²·æˆ–å…ˆç”¨é¤å†å…¥ä½ã€‚", tags:["warn"]},
            { time: "æé†’", name: "ä¿æš–", desc: "å¤œæ™šæ°£æº«ä½ï¼Œè€å±‹ç©ºé–“å¤§ï¼Œå­©å­ç©¿ä¿æš–ç¡è¡£ã€‚", tags:["warn"]},
          ]}
        ]
      },
      {
        id: "day4",
        date: "2026/2/10ï¼ˆäºŒï¼‰",
        dayLabel: "Day 4",
        headline: "ç®±é¤¨å±±ç©é›ªï¼‹æ°´æ‰æ—è”­é“ï¼‹é›„ç´æº«æ³‰ï¼ˆç‰¹è‰²æº«æ³‰ IIï¼‰",
        areas: ["æ»‹è³€ãƒ»é«˜å³¶", "é›„ç´æº«æ³‰"],
        sections: [
          { title: "è¡Œç¨‹", items: [
            { time: "09:00â€“15:30", name: "ç®±é¤¨å±±æ»‘é›ªå ´ï¼ˆBiwako Hakodateyamaï¼‰", desc: "è¦ªå­ç©é›ªï¼›ä¿¯ç°çµç¶æ¹–ã€‚", places:["Biwako Hakodateyama Ski Resort"]},
            { time: "16:00â€“", name: "æ°´æ‰æ—è”­å¤§é“ï¼ˆMetasequoia Namikiï¼‰", desc: "ç©é›ªæ™‚è¶…å¤¢å¹»ã€‚", places:["Metasequoia Namiki"]},
            { time: "æ™šé¤/ä½å®¿", name: "çµç¶æ¹–èŠ±è¡—é“é£¯åº—ï¼ˆæˆ–åŒç´šé›„ç´æº«æ³‰ï¼‰", desc: "æ³¡æ¹¯æ”¾é¬†ã€‚", places:["Biwako Hanakaido", "Ogoto Onsen"]},
          ]},
          { title: "å°æé†’", items: [
            { time: "æé†’", name: "å‚™ç”¨ä¹¾è¥ª/å…§è¡£", desc: "ç©é›ªå¾Œæ›´æ›é¿å…è‘—æ¶¼ã€‚", tags:["warn"]},
            { time: "æé†’", name: "16:30 å‰åˆ°æ°´æ‰å¤§é“", desc: "2æœˆæ—¥è½ç´„ 17:15ã€‚", tags:["warn"]},
          ]}
        ]
      },
      {
        id: "day5",
        date: "2026/2/11ï¼ˆä¸‰ï¼‰",
        dayLabel: "Day 5",
        headline: "å®‡æ²»æŠ¹èŒ¶é¦™ï¼‹å¥ˆè‰¯ç‰ç’ƒç¹ªï¼ˆå‡æ—¥äººæ½®å¤šï¼‰",
        areas: ["å®‡æ²»", "å¥ˆè‰¯", "å¤§é˜ª"],
        sections: [
          { title: "è¡Œç¨‹", items: [
            { time: "09:30", name: "å‰å¾€å®‡æ²»", desc: "åœ‹å®šå‡æ—¥ï¼Œå»ºè­°æ—©å‡ºç™¼ã€‚", places:["Uji, Kyoto"], tags:["warn"]},
            { time: "ä¸Šåˆ", name: "å¹³ç­‰é™¢ï¼ˆByodoinï¼‰", desc: "é³³å‡°å ‚ã€‚", places:["Byodoin"]},
            { time: "æŠ¹èŒ¶", name: "ä¸­æ‘è—¤å‰ï¼ˆå¹³ç­‰é™¢åº—ï¼‰", desc: "å¯å¤–å¸¶æŠ¹èŒ¶å‡/éœœæ·‡æ·‹ã€‚", places:["Nakamura Tokichi Honten (Byodo-in branch)"]},
            { time: "æŠ¹èŒ¶", name: "ä¼Šè—¤ä¹…å³è¡›é–€ï¼ˆå®‡æ²»æœ¬åº—ï¼‰", desc: "æŠ¹èŒ¶èŠ­è²ã€‚", places:["Itohkyuemon Uji Honten"]},
            { time: "æŠ¹èŒ¶", name: "å¢ç”°èŒ¶èˆ–ï¼ˆMasuda Chahoï¼‰", desc: "æ¿ƒéƒæŠ¹èŒ¶éœœæ·‡æ·‹ã€‚", places:["Masuda Chaho"]},
            { time: "ä¸‹åˆ", name: "å¥ˆè‰¯å…¬åœ’ï¼†æ±å¤§å¯º", desc: "çœ‹å¤§ä½›ã€é¤µé¹¿ã€‚", places:["Nara Park", "Todai-ji Temple"]},
            { time: "18:00â€“21:00", name: "å¥ˆè‰¯ç‰ç’ƒç¹ªï¼ˆNara Rurieï¼‰", desc: "æ·±è—ç‰ç’ƒç‡ˆæµ·ä¸²è¯å¤éƒ½ã€‚", places:["Nara Rurie", "Kasuga Taisha", "Kofuku-ji", "Todai-ji Temple"], tags:["good"]},
            { time: "21:00å¾Œ", name: "å‰å¾€å¤§é˜ªå¸‚å€", desc: "è»Šç¨‹ç´„ 40 åˆ†ã€‚", places:["Osaka, Japan"]},
          ]}
        ]
      },
      {
        id: "day6",
        date: "2026/2/12ï¼ˆå››ï¼‰",
        dayLabel: "Day 6",
        headline: "å‹é‹é”æ‘©ï¼‹è¬åšè¦ªå­æ—¥ï¼ˆåŒ—å¤§é˜ªï¼‰",
        areas: ["ç®•é¢", "è¬åšç´€å¿µå…¬åœ’", "å¤§é˜ª"],
        sections: [
          { title: "è¡Œç¨‹", items: [
            { time: "ä¸Šåˆ", name: "å‹å°¾å¯ºï¼ˆKatsuojiï¼‰", desc: "é”æ‘©æµ·è¶…å£¯è§€ã€‚", places:["Katsuoji"]},
            { time: "ä¸­åˆ/ä¸‹åˆ", name: "Expocity", desc: "å•†å ´åˆé¤ã€‚", places:["Expocity"]},
            { time: "ä¸‹åˆ", name: "NIFREL", desc: "è—è¡“Ã—å‹•ç‰©é«”é©—ã€‚", places:["NIFREL"]},
            { time: "è³¼ç‰©", name: "LaLaport EXPOCITY", desc: "è¦ªå­è³¼ç‰©ã€‚", places:["Mitsui Shopping Park LaLaport EXPOCITY"]},
          ]}
        ]
      },
      {
        id: "day7",
        date: "2026/2/13ï¼ˆäº”ï¼‰",
        dayLabel: "Day 7",
        headline: "ç¶“å…¸å¤§é˜ªï¼‹å¯¶å¯å¤¢æ——è‰¦ï¼‹é“é “å €",
        areas: ["å¤§é˜ª"],
        sections: [
          { title: "è¡Œç¨‹", items: [
            { time: "ä¸Šåˆ", name: "æµ·éŠé¤¨", desc: "é¯¨é¯Šå¿…çœ‹ã€‚", places:["Osaka Aquarium Kaiyukan"]},
            { time: "14:20", name: "Pokemon Center Osaka DX", desc: "å¤§ä¸¸å¿ƒé½‹æ©‹ 9Fã€‚", places:["PokÃ©mon Center Osaka DX"]},
            { time: "å‚æ™š", name: "å¿ƒé½‹æ©‹ï¼é“é “å €", desc: "è·‘è·‘äººåˆç…§ã€åƒå¤§é˜ªç¾é£Ÿã€‚", places:["Shinsaibashi-suji Shopping Street", "Dotonbori"]},
          ]}
        ]
      },
      {
        id: "day8",
        date: "2026/2/14ï¼ˆå…­ï¼‰",
        dayLabel: "Day 8",
        headline: "Rinku Outlet æœ€å¾Œè¡åˆºï¼‹è¿”å®¶",
        areas: ["è‡¨ç©ºåŸ", "é—œè¥¿æ©Ÿå ´"],
        sections: [
          { title: "è¡Œç¨‹", items: [
            { time: "å‡ºç™¼å‰", name: "Rinku Premium Outlets", desc: "æœ€å¾Œè³¼ç‰©ã€‚", places:["Rinku Premium Outlets"]},
            { time: "14:00", name: "é—œè¥¿æ©Ÿå ´é‚„è»Šï¼å ±åˆ°", desc: "ç•™è¶³æ™‚é–“ã€‚", places:["Kansai International Airport"]},
          ]}
        ]
      }
    ]
  };

  // ===== Collect map targets + route points =====
  const maxStops = 10;

  function shouldDropTaiwanNoise(s){
    const key = (s || "").toLowerCase();
    return key.includes("æ¡ƒåœ’") || key.includes("ä¸­å£¢") || key.includes("è¯æ³°") || key.includes("tai cuisine");
  }

  function collectRoutePoints(day){
    const pts = [];
    const seen = new Set();
    const push = (p) => {
      const s = (p || "").trim();
      if (!s) return;
      if (shouldDropTaiwanNoise(s)) return;
      const k = s.toLowerCase();
      if (seen.has(k)) return;
      seen.add(k);
      pts.push(s);
    };

    (day.sections || []).forEach(sec=>{
      (sec.items || []).forEach(it=>{
        if (it.places && it.places.length){
          it.places.forEach(push);
        } else if (it.placeLinks && it.placeLinks.length){
          push(it.name);
        }
      });
    });

    if (!pts.length && day.areas && day.areas.length){
      day.areas.forEach(push);
    }
    return pts.slice(0, maxStops);
  }

  function collectMapTargets(day){
    const targets = [];
    const seen = new Set();

    (day.sections || []).forEach(sec=>{
      (sec.items || []).forEach(it=>{
        if (it.placeLinks && it.placeLinks.length){
          it.placeLinks.forEach(pl=>{
            const label = pl.label || it.name || "Google Maps";
            const key = "L:" + label;
            if (seen.has(key)) return;
            seen.add(key);
            const query = (it.name || label).replace(/^Google Mapsï¼š/,"").trim();
            targets.push({ label, embedSrc: mapsEmbed(query), openSrc: mapsLink(pl.url) });
          });
        }
        if (it.places && it.places.length){
          it.places.forEach(p=>{
            if (shouldDropTaiwanNoise(p)) return;
            const key = "P:" + p.toLowerCase();
            if (seen.has(key)) return;
            seen.add(key);
            targets.push({ label:`Google Mapsï¼š${p}`, embedSrc: mapsEmbed(p), openSrc: mapsSearch(p) });
          });
        }
      });
    });

    if (!targets.length && day.areas && day.areas.length){
      const p = day.areas[0];
      targets.push({ label:`Google Mapsï¼š${p}`, embedSrc: mapsEmbed(p), openSrc: mapsSearch(p) });
    }

    return targets.slice(0, 12);
  }

  // ===== Render =====
  const daysWrap = document.getElementById("days");
  const daylist = document.getElementById("daylist");
  const qInput = document.getElementById("q");

  function build(){
    daysWrap.innerHTML = "";
    daylist.innerHTML = "";

    trip.days.forEach((d, idx) => {
      // Bottom sheet day links
      const link = el("div", {
        class:"daylink",
        onclick:()=> {
          closeSheet();
          document.getElementById(d.id).scrollIntoView({behavior:"smooth", block:"start"});
        }
      }, [
        el("div",{class:"left"},[
          el("div",{class:"d"}, `${d.dayLabel}ï½œ${d.date}`),
          el("div",{class:"meta"}, d.headline)
        ]),
        el("div",{class:"badge"}, (d.areas||[]).slice(0,2).join("ãƒ»") + ((d.areas||[]).length>2?"â€¦":""))
      ]);
      daylist.appendChild(link);

      // Day details
      const detail = el("details", { class:"day", id: d.id, open: idx === 0 });
      const summary = el("summary", {}, [
        el("div",{class:"sumL"},[
          el("div",{class:"sumTitle"}, `${d.dayLabel}ï½œ${d.date}`),
          el("div",{class:"sumSub"}, d.headline),
        ]),
        el("div",{class:"sumR"}, (d.areas||[]).slice(0,2).join(" â†’ ") + ((d.areas||[]).length>2?"â€¦":""))
      ]);

      const body = el("div",{class:"body"});

      // Map + Route section
      const targets = collectMapTargets(d);
      const routePoints = collectRoutePoints(d);
      const routeUrl = mapsDirections(routePoints, "driving");

      const mapSec = el("div",{class:"section"});
      mapSec.appendChild(el("h3",{}, "ğŸ§­ ä»Šæ—¥è·¯ç·šï¼†äº’å‹•åœ°åœ–"));

      const head = el("div",{class:"mapBoxHead"});
      const leftInfo = el("div",{class:"small"},
        `è·¯ç·šé»æ•¸ï¼š${routePoints.length}ï¼ˆæœ€å¤š ${maxStops} é»ï¼‰ï½œå»ºè­°æŒ‰ã€Œé–‹ç•¶æ—¥è·¯ç·šï¼ˆå¤šé»ï¼‰ã€ç”¨ Google Maps å°èˆªã€‚`
      );

      const controls = el("div",{class:"mapControls"});
      const select = el("select",{class:"select", "aria-label":"é¸æ“‡ä»Šæ—¥æ™¯é»"});
      targets.forEach((t,i)=> select.appendChild(el("option",{value:String(i)}, t.label)));

      const openRouteBtn = el("a",{
        class:"maplink",
        href: routeUrl,
        target:"_blank",
        rel:"noopener noreferrer"
      },[
        el("span",{class:"pin"},"ğŸ§­"),
        el("span",{}, "é–‹ç•¶æ—¥è·¯ç·šï¼ˆå¤šé»ï¼‰")
      ]);

      const openPointBtn = el("a",{
        class:"maplink",
        href: targets[0]?.openSrc || "#",
        target:"_blank",
        rel:"noopener noreferrer"
      },[
        el("span",{class:"pin"},"ğŸ“"),
        el("span",{}, "é–‹å–®é»")
      ]);

      controls.appendChild(select);
      controls.appendChild(openRouteBtn);
      controls.appendChild(openPointBtn);

      head.appendChild(leftInfo);
      head.appendChild(controls);

      const frameWrap = el("div",{class:"mapFrameWrap"});
      const iframe = el("iframe",{
        class:"mapFrame",
        src: targets[0]?.embedSrc || mapsEmbed(d.areas?.[0] || "Japan"),
        loading:"lazy",
        referrerpolicy:"no-referrer-when-downgrade",
        allowfullscreen:""
      });
      frameWrap.appendChild(iframe);

      mapSec.appendChild(head);
      mapSec.appendChild(frameWrap);
      body.appendChild(mapSec);

      select.addEventListener("change", ()=>{
        const i = Number(select.value);
        const t = targets[i];
        if (!t) return;
        iframe.src = t.embedSrc;
        openPointBtn.href = t.openSrc;
      });

      // Itinerary sections
      (d.sections||[]).forEach(sec=>{
        const box = el("div",{class:"section"});
        box.appendChild(el("h3",{}, sec.title));
        const items = el("div",{class:"items"});

        (sec.items||[]).forEach(it=>{
          const top = el("div",{class:"top"},[
            el("div",{class:"name"}, it.name || ""),
            el("div",{class:"time"}, it.time || "")
          ]);
          const desc = el("div",{class:"desc"}, it.desc || "");
          const card = el("div",{class:"item"}, [top, desc]);

          if (it.tags && it.tags.length){
            const tr = el("div",{class:"tagrow"});
            it.tags.forEach(t=>{
              let cls = "tag";
              if (t === "warn") cls += " warn";
              if (t === "good") cls += " good";
              if (t === "bad") cls += " bad";
              tr.appendChild(el("span",{class:cls}, t==="warn"?"æ³¨æ„":t==="good"?"äº®é»":t==="bad"?"é¢¨éšª":t));
            });
            card.appendChild(tr);
          }

          if (it.placeLinks && it.placeLinks.length){
            const mr = el("div",{class:"maps"});
            it.placeLinks.forEach(p=>{
              mr.appendChild(
                el("a",{class:"maplink", href: mapsLink(p.url), target:"_blank", rel:"noopener noreferrer"},[
                  el("span",{class:"pin"}, "ğŸ“"),
                  el("span",{}, p.label)
                ])
              );
            });
            card.appendChild(mr);
          }

          if (it.places && it.places.length){
            const mr = el("div",{class:"maps"});
            it.places.forEach(p=>{
              if (shouldDropTaiwanNoise(p)) return;
              mr.appendChild(
                el("a",{class:"maplink", href: mapsSearch(p), target:"_blank", rel:"noopener noreferrer"},[
                  el("span",{class:"pin"}, "ğŸ“"),
                  el("span",{}, `Google Mapsï¼š${p}`)
                ])
              );
            });
            if (mr.childNodes.length) card.appendChild(mr);
          }

          items.appendChild(card);
        });

        box.appendChild(items);
        body.appendChild(box);
      });

      detail.appendChild(summary);
      detail.appendChild(body);
      daysWrap.appendChild(detail);
    });
  }

  build();

  // ===== Search / Filter =====
  function applyFilter(){
    const q = (qInput.value || "").trim().toLowerCase();
    const dayDetails = [...document.querySelectorAll("details.day")];

    dayDetails.forEach(dd=>{
      const text = dd.textContent.toLowerCase();
      const hit = !q || text.includes(q);
      dd.classList.toggle("hidden", !hit);

      if (hit){
        const nodes = dd.querySelectorAll(".sumTitle, .sumSub, .name, .desc, h3, .meta, .small");
        nodes.forEach(n=>{
          const raw = n.getAttribute("data-raw") || n.textContent;
          n.setAttribute("data-raw", raw);
          if (n.tagName.toLowerCase() === "option") return;
          n.innerHTML = highlight(raw, q);
        });
      }
    });

    // Bottom-sheet list filtering + highlight
    const links = [...daylist.querySelectorAll(".daylink")];
    links.forEach((lnk, i)=>{
      const d = trip.days[i];
      const combined = `${d.dayLabel} ${d.date} ${d.headline} ${(d.areas||[]).join(" ")}`.toLowerCase();
      lnk.classList.toggle("hidden", !!q && !combined.includes(q));
      const dEl = lnk.querySelector(".d");
      const mEl = lnk.querySelector(".meta");
      dEl.innerHTML = highlight(`${d.dayLabel}ï½œ${d.date}`, q);
      mEl.innerHTML = highlight(d.headline, q);
    });
  }
  qInput.addEventListener("input", applyFilter);

  // ===== Zoom =====
  const zoom = document.getElementById("zoom");
  const zoomLabel = document.getElementById("zoomLabel");
  zoom.addEventListener("input", ()=>{
    const v = Number(zoom.value);
    document.documentElement.style.setProperty("--scale", (v/100).toFixed(2));
    zoomLabel.textContent = `${v}%`;
  });

  // ===== Open / Close all =====
  document.getElementById("openAll").addEventListener("click", ()=>{
    document.querySelectorAll("details.day").forEach(d=> d.open = true);
  });
  document.getElementById("closeAll").addEventListener("click", ()=>{
    document.querySelectorAll("details.day").forEach(d=> d.open = false);
  });

  // ===== Share text =====
  document.getElementById("share").addEventListener("click", async ()=>{
    const text =
`ã€${trip.title}ã€‘ï¼ˆ${trip.range}ï¼‰
æ‰‹æ©Ÿç‰ˆäº’å‹•è¡Œç¨‹ï¼šå¯æœå°‹/ç¸®æ”¾/è·³æ—¥/æ¯æ—¥äº’å‹•åœ°åœ–/ä¸€éµé–‹ç•¶æ—¥å¤šé»è·¯ç·šï¼ˆGoogle Mapsï¼‰
æç¤ºï¼šç§Ÿè»Šå‹™å¿…é¸é›ªåœ°è¼ªèƒï¼›å¥ˆè‰¯ç‰ç’ƒç¹ªæ™šé–“å¾ˆå†·ï¼Œè¨˜å¾—å¸½æ‰‹å¥—æš–æš–åŒ…ã€‚`;

    try{
      await navigator.clipboard.writeText(text);
      alert("å·²è¤‡è£½åˆ†äº«æ–‡å­—åˆ°å‰ªè²¼ç°¿ âœ…\nå¯ç›´æ¥è²¼åˆ°LINE/WhatsAppç¾¤çµ„");
    }catch(e){
      prompt("ä½ çš„ç€è¦½å™¨ä¸å…è¨±è‡ªå‹•è¤‡è£½ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š", text);
    }
  });

  // ===== Bottom sheet (Jump to Day) =====
  const sheetBack = document.getElementById("sheetBack");
  const sheet = document.getElementById("sheet");
  const fab = document.getElementById("fab");
  const closeBtn = document.getElementById("closeSheet");

  function openSheet(){
    sheetBack.classList.add("show");
    requestAnimationFrame(()=> sheet.classList.add("open"));
  }
  function closeSheet(){
    sheet.classList.remove("open");
    setTimeout(()=> sheetBack.classList.remove("show"), 200);
  }
  fab.addEventListener("click", openSheet);
  closeBtn.addEventListener("click", closeSheet);
  sheetBack.addEventListener("click", closeSheet);

  // ===== Improve mobile UX: collapse others when opening one day =====
  document.addEventListener("toggle", (e)=>{
    const target = e.target;
    if (!(target instanceof HTMLDetailsElement)) return;
    if (!target.classList.contains("day")) return;
    if (!target.open) return;
    document.querySelectorAll("details.day").forEach(d=>{
      if (d !== target) d.open = false;
    });
  }, true);
</script>
</body>
</html>
